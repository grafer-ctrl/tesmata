<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shadow Hunter - Contrast Test</title>
    <style>
        /* --- DARK MODE UI --- */
        :root {
            --bg: #2d3436; /* Dark Grey */
            --ui-bg: #1e272e;
            --text: #dfe6e9;
            --accent: #00cec9;
            --correct: #00b894;
            --wrong: #d63031;
            --ad-h: 75px;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--ui-bg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .stat { font-weight: bold; font-size: 1.1rem; }

        /* GAME AREA */
        #game-stage {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: #404040; /* The Base Gray Color */
            transition: background 0.3s;
        }

        /* THE GHOST SHAPE */
        #ghost-shape {
            width: 200px;
            height: 200px;
            background-color: #484848; /* Slightly lighter than bg initially */
            transition: all 0.3s ease;
        }

        /* CONTROLS (BUTTONS) */
        #controls {
            padding: 20px;
            background: var(--ui-bg);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
        }

        .control-btn {
            background: #636e72;
            border: none;
            border-radius: 12px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.1s;
        }
        .control-btn:active { transform: scale(0.95); background: var(--accent); }
        
        /* Icon shapes for buttons */
        .icon { width: 30px; height: 30px; background: white; }
        .icon-square { clip-path: inset(0); }
        .icon-circle { clip-path: circle(50%); }
        .icon-triangle { clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .icon-diamond { clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); }

        /* SCREENS */
        .screen {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 50;
            padding: 30px;
        }
        .screen.active { display: flex; }

        h1 { font-size: 2.5rem; margin-bottom: 10px; color: var(--accent); }
        p { color: #b2bec3; margin-bottom: 30px; line-height: 1.5; }

        .btn-main {
            background: linear-gradient(135deg, #0984e3, #00cec9);
            color: white;
            border: none; padding: 15px 50px;
            font-size: 1.2rem; border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 206, 201, 0.4);
        }

        /* AD FOOTER */
        #ad-wrapper {
            height: var(--ad-h);
            min-height: var(--ad-h);
            background: #000;
            border-top: 1px solid #444;
            display: flex; justify-content: center; align-items: center;
            z-index: 100;
        }
        .ad-scale { transform: scale(0.75); }

        /* SHAPE DEFINITIONS (CSS Clip-Path) */
        .shape-square { clip-path: inset(0); }
        .shape-circle { clip-path: circle(50%); }
        .shape-triangle { clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .shape-diamond { clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="stat">Level <span id="ui-lvl" style="color:var(--accent)">1</span></div>
        <div class="stat">Lives <span id="ui-lives" style="color:var(--wrong)">3</span></div>
    </header>

    <!-- MAIN GAME STAGE -->
    <div id="game-stage">
        <div id="ghost-shape" class="shape-circle"></div>
    </div>

    <!-- CONTROLS -->
    <div id="controls">
        <button class="control-btn" onclick="game.check('square')"><div class="icon icon-square"></div></button>
        <button class="control-btn" onclick="game.check('circle')"><div class="icon icon-circle"></div></button>
        <button class="control-btn" onclick="game.check('triangle')"><div class="icon icon-triangle"></div></button>
        <button class="control-btn" onclick="game.check('diamond')"><div class="icon icon-diamond"></div></button>
    </div>

    <!-- MENU SCREEN -->
    <div id="s-menu" class="screen active">
        <div style="font-size:4rem; margin-bottom:15px;">ðŸ‘»</div>
        <h1>Shadow Hunter</h1>
        <p>Test your contrast sensitivity.<br>Identify the faint shape hidden in the gray background.</p>
        <button class="btn-main" onclick="game.start()">START TEST</button>
    </div>

    <!-- RESULT SCREEN -->
    <div id="s-over" class="screen">
        <h2 style="color:var(--wrong)">TEST COMPLETE</h2>
        <p>You reached:</p>
        <h1 id="final-score" style="font-size:3.5rem; margin:0; color:white">Level 10</h1>
        <p id="final-msg">Good Night Vision.</p>
        <button class="btn-main" onclick="game.start()">TRY AGAIN</button>
    </div>

    <!-- AD AREA -->
    <div id="ad-wrapper">
        <div class="ad-scale">
            <!-- Adsterra Code -->
            <script type="text/javascript">
                atOptions = {
                    'key' : '2a28cd5411ae53a35cf4ec828d845d19',
                    'format' : 'iframe',
                    'height' : 60,
                    'width' : 468,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="https://www.highperformanceformat.com/2a28cd5411ae53a35cf4ec828d845d19/invoke.js"></script>
        </div>
    </div>

    <script>
        const game = {
            level: 1,
            lives: 3,
            currentShape: '',
            baseColor: 60, // Base Gray Value (0-255)
            shapes: ['square', 'circle', 'triangle', 'diamond'],
            
            elStage: document.getElementById('game-stage'),
            elGhost: document.getElementById('ghost-shape'),

            start: function() {
                this.level = 1;
                this.lives = 3;
                this.updateUI();
                this.screen('s-none');
                this.nextRound();
            },

            nextRound: function() {
                // 1. Pick Random Shape
                const randomShape = this.shapes[Math.floor(Math.random() * this.shapes.length)];
                this.currentShape = randomShape;

                // 2. Set Shape Class
                this.elGhost.className = ''; // Reset
                this.elGhost.classList.add('shape-' + randomShape);

                // 3. Calculate Contrast Difficulty
                // Logic: Contrast decreases as level increases.
                // Level 1: Difference 30 (Easy) -> Level 50: Difference 1 (Invisible)
                
                let difference = Math.max(2, 35 - (this.level * 0.8));
                
                // Apply Colors
                // Background color
                const bgVal = this.baseColor; 
                this.elStage.style.backgroundColor = `rgb(${bgVal}, ${bgVal}, ${bgVal})`;
                
                // Shape color (Slightly lighter than background)
                const shapeVal = bgVal + difference;
                this.elGhost.style.backgroundColor = `rgb(${shapeVal}, ${shapeVal}, ${shapeVal})`;

                // 4. Randomize Size slightly (optional, keeps it dynamic)
                const size = 150 + Math.random() * 50;
                this.elGhost.style.width = size + 'px';
                this.elGhost.style.height = size + 'px';
            },

            check: function(userChoice) {
                if(userChoice === this.currentShape) {
                    // CORRECT
                    this.level++;
                    
                    // Visual Feedback
                    this.elGhost.style.backgroundColor = 'var(--correct)'; // Flash Green
                    setTimeout(() => {
                        this.updateUI();
                        this.nextRound();
                    }, 200);

                } else {
                    // WRONG
                    this.lives--;
                    navigator.vibrate && navigator.vibrate(200);
                    
                    // Flash Red
                    this.elStage.style.backgroundColor = 'var(--wrong)';
                    setTimeout(() => {
                         // Revert color temporarily before next action
                        this.elStage.style.backgroundColor = `rgb(${this.baseColor}, ${this.baseColor}, ${this.baseColor})`;
                        
                        if(this.lives <= 0) {
                            this.gameOver();
                        } else {
                            this.updateUI();
                        }
                    }, 200);
                }
            },

            updateUI: function() {
                document.getElementById('ui-lvl').innerText = this.level;
                document.getElementById('ui-lives').innerText = this.lives;
            },

            gameOver: function() {
                document.getElementById('final-score').innerText = "Level " + this.level;
                
                let msg = "Needs Improvement.";
                if(this.level > 15) msg = "Normal Contrast Vision.";
                if(this.level > 30) msg = "Excellent Sensitivity!";
                if(this.level > 45) msg = "Night Owl Eyes!";
                
                document.getElementById('final-msg').innerText = msg;
                this.screen('s-over');
            },

            screen: function(id) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const el = document.getElementById(id);
                if(el) el.classList.add('active');
            }
        };
    </script>
</body>
</html>